# Auth Feature

Authentication using Better Auth with email/password support.

## Setup

1. **Configure Database URL**
   ```bash
   # In .env file
   DATABASE_URL=postgresql://user:password@localhost:5432/littlejohn
   BETTER_AUTH_SECRET=your-secret-key-min-32-chars
   BETTER_AUTH_URL=http://localhost:3000
   ```

2. **Run Database Migrations**
   ```bash
   bun run db:push
   # or for production
   bun run db:migrate
   ```

3. **Generate Prisma Client**
   ```bash
   bun run db:generate
   ```

## Better Auth Endpoints

Better Auth automatically provides these endpoints at `/api/auth/*`:

### Sign Up
```bash
POST /api/auth/sign-up/email
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePassword123",
  "name": "John Doe"
}
```

### Sign In
```bash
POST /api/auth/sign-in/email
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePassword123"
}
```

### Sign Out
```bash
POST /api/auth/sign-out
```

### Get Session
```bash
GET /api/auth/get-session
```

### Update User
```bash
POST /api/auth/update-user
Content-Type: application/json

{
  "name": "Updated Name"
}
```

## Database Schema

The auth feature uses these Prisma models (auto-generated by Better Auth):

- **User** - User accounts (id, email, name, emailVerified, image, timestamps)
- **Account** - OAuth accounts and email/password credentials (userId, providerId, tokens, password hash)
- **Session** - User sessions (sessionToken, userId, expiresAt, token, ipAddress, userAgent)
- **Verification** - Email verification tokens (identifier, value, expiresAt)

## TypeScript Types

Better Auth and Prisma provide all necessary types:

```typescript
// Better Auth types
import type { Session, User } from 'better-auth/types';

// Prisma generated types
import type { User, Account, Session, Verification } from '@prisma/client';

// Auth instance type
import type { Auth } from './auth';
```

No custom types are needed - Better Auth handles everything!

## Configuration

Edit `auth.ts` to customize:
- Email verification requirements
- Session duration
- Password requirements
- Additional authentication providers

## Testing

1. Start the server: `bun run dev`
2. Sign up a new user:
   ```bash
   curl -X POST http://localhost:3000/api/auth/sign-up/email \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"Test123456","name":"Test User"}'
   ```
3. Sign in:
   ```bash
   curl -X POST http://localhost:3000/api/auth/sign-in/email \
     -H "Content-Type: application/json" \
     -d '{"email":"test@example.com","password":"Test123456"}'
   ```

## Security Notes

- Email verification is currently disabled for development
- Enable `requireEmailVerification: true` in production
- Use a strong `BETTER_AUTH_SECRET` (min 32 characters)
- Use HTTPS in production (`BETTER_AUTH_URL=https://...`)
